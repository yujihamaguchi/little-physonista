steps:
  - task: AzureKeyVault@2
    inputs:
      azureSubscription: $(KEY_VAULT_SERVICE_CONNECTION_NAME)
      KeyVaultName: $(KEY_VAULT_NAME)
      SecretsFilter: '*'
      RunAsPreJob: false
  - template: login-registory.yaml
  - script: |
      docker pull $(fQIN)
      docker run  \
      -e AUTHORIZED_USER_PAT=$(AuthorizedUserPAT) \
      -e UNAUTHORIZED_USER_PAT=$(UnauthorizedUserPAT) \
      --rm $(fQIN) pytest ./it.py
    displayName: 'Run Integration Test'
    continueOnError: false
